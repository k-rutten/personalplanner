<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weekplanner</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type="number"] { -moz-appearance: textfield; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect, useCallback } = React;

        const DAYS = ['maandag', 'dinsdag', 'woensdag', 'donderdag', 'vrijdag'];
        const DAY_LABELS = { maandag: 'Maandag', dinsdag: 'Dinsdag', woensdag: 'Woensdag', donderdag: 'Donderdag', vrijdag: 'Vrijdag' };
        const DAY_SHORT = { maandag: 'Ma', dinsdag: 'Di', woensdag: 'Wo', donderdag: 'Do', vrijdag: 'Vr' };
        const HOURS_PER_DAY = 8;
        const STORAGE_KEY = 'weekplanner_data';

        function getMonday(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            d.setDate(diff);
            d.setHours(0, 0, 0, 0);
            return d;
        }

        function formatDate(date) {
            return date.toISOString().split('T')[0];
        }

        function getDayDate(mondayDate, dayIndex) {
            const d = new Date(mondayDate);
            d.setDate(d.getDate() + dayIndex);
            return d.toLocaleDateString('nl-NL', { day: 'numeric', month: 'short' });
        }

        function createEmptyWeek() {
            const days = {};
            DAYS.forEach(day => {
                days[day] = { workHours: 0, freeHours: 0 };
            });
            return days;
        }

        function loadAllData() {
            try {
                const raw = localStorage.getItem(STORAGE_KEY);
                return raw ? JSON.parse(raw) : {};
            } catch { return {}; }
        }

        function saveAllData(data) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
        }

        function encodeWeekToURL(weekKey, weekData) {
            const payload = { week: weekKey, days: weekData };
            const encoded = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
            return window.location.origin + window.location.pathname + '?d=' + encoded;
        }

        function decodeWeekFromURL() {
            const params = new URLSearchParams(window.location.search);
            const encoded = params.get('d');
            if (!encoded) return null;
            try {
                const json = decodeURIComponent(escape(atob(encoded)));
                return JSON.parse(json);
            } catch { return null; }
        }

        const fmt = (n) => Number.isInteger(n) ? n : n.toFixed(1);

        // --- Components ---

        function DayCard({ day, dayIndex, mondayDate, data, onChange }) {
            const workHours = parseFloat(data.workHours) || 0;
            const freeHours = parseFloat(data.freeHours) || 0;
            const totalDay = workHours + freeHours;
            const approved = totalDay >= HOURS_PER_DAY;

            const setWork = (val) => onChange(day, { ...data, workHours: val });
            const setFree = (val) => onChange(day, { ...data, freeHours: val });

            return (
                <div className={`bg-white rounded-xl shadow-sm border overflow-hidden ${approved ? 'border-green-200' : 'border-gray-200'} sm:min-w-[180px] sm:flex-1`}>
                    {/* Header */}
                    <div className={`flex items-center justify-between px-4 py-2.5 sm:flex-col sm:py-3 sm:text-center sm:border-b ${approved ? 'bg-green-50 border-b border-green-200' : 'bg-gray-50 border-b border-gray-200'}`}>
                        <div>
                            <span className="font-semibold text-gray-800">{DAY_LABELS[day]}</span>
                            <span className="text-xs text-gray-400 ml-1.5 sm:ml-0 sm:block">{getDayDate(mondayDate, dayIndex)}</span>
                        </div>
                        <div className={`text-sm font-medium ${approved ? 'text-green-600' : 'text-orange-500'}`}>
                            {fmt(totalDay)}/{HOURS_PER_DAY}u {approved ? '\u2713' : ''}
                        </div>
                    </div>

                    {/* Inputs */}
                    <div className="grid grid-cols-2 gap-2 p-3 sm:grid-cols-1 sm:gap-3">
                        <div className="bg-blue-50 rounded-lg px-3 py-2.5 border border-blue-100">
                            <label className="text-xs text-blue-600 font-medium block mb-1">Werk</label>
                            <div className="flex items-center gap-1">
                                <input
                                    type="number"
                                    value={workHours || ''}
                                    onChange={e => setWork(parseFloat(e.target.value) || 0)}
                                    placeholder="0"
                                    min="0" max="24" step="0.5"
                                    className="w-full text-lg sm:text-base font-semibold text-center py-1 border border-blue-200 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white"
                                />
                                <span className="text-xs text-blue-400">u</span>
                            </div>
                        </div>

                        <div className="bg-amber-50 rounded-lg px-3 py-2.5 border border-amber-100">
                            <label className="text-xs text-amber-600 font-medium block mb-1">Vrij</label>
                            <div className="flex items-center gap-1">
                                <input
                                    type="number"
                                    value={freeHours || ''}
                                    onChange={e => setFree(parseFloat(e.target.value) || 0)}
                                    placeholder="0"
                                    min="0" max="8" step="0.5"
                                    className="w-full text-lg sm:text-base font-semibold text-center py-1 border border-amber-200 rounded-md focus:outline-none focus:ring-2 focus:ring-amber-400 bg-white"
                                />
                                <span className="text-xs text-amber-400">u</span>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        function WeekSummary({ days }) {
            let totalWork = 0;
            let totalFree = 0;
            let approvedDays = 0;

            DAYS.forEach(day => {
                const d = days[day] || { workHours: 0, freeHours: 0 };
                const work = parseFloat(d.workHours) || 0;
                const free = parseFloat(d.freeHours) || 0;
                totalWork += work;
                totalFree += free;
                if (work + free >= HOURS_PER_DAY) approvedDays++;
            });

            const totalHours = totalWork + totalFree;
            const weekTarget = HOURS_PER_DAY * 5;
            const pct = weekTarget > 0 ? Math.round((totalHours / weekTarget) * 100) : 0;
            const barPct = Math.min(pct, 100);

            return (
                <div className="bg-white rounded-xl shadow-sm border border-gray-200 p-4 sm:p-5">
                    {/* Mobile: compact grid / Desktop: spread row */}
                    <div className="flex items-center justify-between gap-3 sm:gap-4">
                        <div className="hidden sm:block">
                            <h2 className="text-lg font-semibold text-gray-800">Weektotaal</h2>
                            <p className="text-sm text-gray-500 mt-0.5">
                                {approvedDays} van 5 dagen voltooid
                            </p>
                        </div>

                        <div className="flex gap-4 sm:gap-6 flex-1 sm:flex-none justify-between sm:justify-end">
                            <div className="text-center">
                                <div className="text-xl sm:text-2xl font-bold text-blue-600">{fmt(totalWork)}</div>
                                <div className="text-[10px] sm:text-xs text-gray-500">/ {weekTarget}u werk</div>
                            </div>
                            <div className="text-center">
                                <div className="text-xl sm:text-2xl font-bold text-amber-500">{fmt(totalFree)}</div>
                                <div className="text-[10px] sm:text-xs text-gray-500">vrije uren</div>
                            </div>
                            <div className="text-center">
                                <div className={`text-xl sm:text-2xl font-bold ${pct >= 100 ? 'text-green-600' : 'text-gray-700'}`}>{pct}%</div>
                                <div className="text-[10px] sm:text-xs text-gray-500">{fmt(totalHours)} / {weekTarget}u</div>
                            </div>
                        </div>
                    </div>

                    {/* Progress bar */}
                    <div className="mt-3 sm:mt-4 flex items-center gap-2 sm:gap-3">
                        <div className="flex-1 bg-gray-100 rounded-full h-2.5 sm:h-3 overflow-hidden">
                            <div
                                className={`h-full rounded-full transition-all duration-500 ${pct >= 100 ? 'bg-green-500' : 'bg-blue-500'}`}
                                style={{ width: `${barPct}%` }}
                            />
                        </div>
                        <span className={`text-xs sm:text-sm font-medium min-w-[2.5rem] sm:min-w-[3rem] text-right ${pct >= 100 ? 'text-green-600' : 'text-gray-500'}`}>{pct}%</span>
                    </div>

                    {/* Mobile subtitle */}
                    <p className="sm:hidden text-xs text-gray-400 mt-2 text-center">
                        {approvedDays} van 5 dagen voltooid
                    </p>
                </div>
            );
        }

        function App() {
            const [currentMonday, setCurrentMonday] = useState(() => getMonday(new Date()));
            const [allData, setAllData] = useState(() => loadAllData());
            const [copied, setCopied] = useState(false);
            const [sharedBanner, setSharedBanner] = useState(null);

            const weekKey = formatDate(currentMonday);
            const weekData = allData[weekKey] || createEmptyWeek();

            useEffect(() => {
                const shared = decodeWeekFromURL();
                if (shared && shared.week && shared.days) {
                    setAllData(prev => ({ ...prev, [shared.week]: shared.days }));
                    setCurrentMonday(new Date(shared.week));
                    setSharedBanner(shared.week);
                    window.history.replaceState({}, '', window.location.pathname);
                }
            }, []);

            useEffect(() => {
                saveAllData(allData);
            }, [allData]);

            const shareWeek = () => {
                const url = encodeWeekToURL(weekKey, weekData);
                navigator.clipboard.writeText(url).then(() => {
                    setCopied(true);
                    setTimeout(() => setCopied(false), 2000);
                });
            };

            const handleDayChange = useCallback((day, newDayData) => {
                setAllData(prev => ({
                    ...prev,
                    [weekKey]: {
                        ...(prev[weekKey] || createEmptyWeek()),
                        [day]: newDayData,
                    }
                }));
            }, [weekKey]);

            const goWeek = (offset) => {
                const next = new Date(currentMonday);
                next.setDate(next.getDate() + offset * 7);
                setCurrentMonday(next);
            };

            const goToday = () => setCurrentMonday(getMonday(new Date()));

            const weekEnd = new Date(currentMonday);
            weekEnd.setDate(weekEnd.getDate() + 4);

            const weekLabel = `${currentMonday.toLocaleDateString('nl-NL', { day: 'numeric', month: 'long' })} \u2014 ${weekEnd.toLocaleDateString('nl-NL', { day: 'numeric', month: 'long', year: 'numeric' })}`;

            return (
                <div className="max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6">
                    {/* Header */}
                    <div className="mb-4 sm:mb-6">
                        <div className="flex items-center justify-between gap-2 mb-2">
                            <h1 className="text-lg sm:text-2xl font-bold text-gray-900">Weekplanner</h1>
                            <button onClick={shareWeek} className={`px-2.5 py-1.5 sm:px-3 sm:py-2 text-xs sm:text-sm rounded-lg transition shadow-sm ${copied ? 'bg-green-600 text-white' : 'bg-white border border-gray-200 hover:bg-gray-50'}`}>
                                {copied ? 'Gekopieerd!' : 'Deel'}
                            </button>
                        </div>
                        <p className="text-xs sm:text-sm text-gray-500">{weekLabel}</p>

                        {/* Navigation */}
                        <div className="flex items-center gap-2 mt-3">
                            <button onClick={() => goWeek(-1)} className="flex-1 sm:flex-none px-3 py-2 text-xs sm:text-sm bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition shadow-sm text-center">
                                ← Vorige
                            </button>
                            <button onClick={goToday} className="flex-1 sm:flex-none px-3 py-2 text-xs sm:text-sm bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition shadow-sm text-center">
                                Vandaag
                            </button>
                            <button onClick={() => goWeek(1)} className="flex-1 sm:flex-none px-3 py-2 text-xs sm:text-sm bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition shadow-sm text-center">
                                Volgende →
                            </button>
                        </div>
                    </div>

                    {/* Shared banner */}
                    {sharedBanner && (
                        <div className="mb-4 bg-blue-50 border border-blue-200 rounded-lg px-3 sm:px-4 py-2 flex items-center justify-between">
                            <span className="text-xs sm:text-sm text-blue-700">Gedeelde weekplanning geladen en opgeslagen.</span>
                            <button onClick={() => setSharedBanner(null)} className="text-blue-400 hover:text-blue-600 text-lg leading-none ml-2">&times;</button>
                        </div>
                    )}

                    {/* Week summary */}
                    <div className="mb-4 sm:mb-6">
                        <WeekSummary days={weekData} />
                    </div>

                    {/* Day cards: 2-col grid on mobile, row on desktop */}
                    <div className="grid grid-cols-2 gap-2 sm:flex sm:flex-row sm:gap-3">
                        {DAYS.map((day, i) => (
                            <DayCard
                                key={day}
                                day={day}
                                dayIndex={i}
                                mondayDate={currentMonday}
                                data={weekData[day] || { workHours: 0, freeHours: 0 }}
                                onChange={handleDayChange}
                            />
                        ))}
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
